<?php

namespace App\Queries\Support;

use App\Models\SupportTicket;

class ShowTicketToAdminQuery
{

    public static function getData($id)
    {

        $select = [
            'support_tickets.id',
            'support_topics.support_topic_name',
            'statuses.status_name',
            'users.name',
            'support_tickets.ticket_text',
            'support_tickets.user_id',
            'support_tickets.status_id',
            'support_tickets.support_topic_id',
            'support_tickets.created_at'];

        $supportTicket = SupportTicket::select($select)
                                      ->leftJoin('support_topics', 'support_tickets.support_topic_id', '=', 'support_topics.id')
                                      ->leftJoin('users', 'support_tickets.user_id', '=', 'users.id')
                                      ->leftJoin('statuses', 'support_tickets.status_id', '=', 'statuses.id')
                                      ->where('support_tickets.id', $id)
                                      ->orderBy('support_tickets.created_at', 'desc')
                                      ->with('ticketResponses')
                                      ->first();

        return $supportTicket;

    }

}