<?php

namespace App\Http\Controllers\Admin\Support;

use App\Http\Controllers\Controller;
use Illuminate\Http\Request;
use App\Services\Support\SupportTableDataService;
use App\Services\Support\SupportReplyToTicketService;
use App\Services\Support\CloseTicketService;
use App\Services\Support\FormConfigs\SupportTicketByStatusService;
use App\Services\Support\FormConfigs\SupportReplyService;
use App\Queries\Support\ShowTicketToAdminQuery;

class SupportController extends Controller
{

    public function index(Request $request, SupportTableDataService $service)
    {

        // list support tickets by status

        $request->validate([

            'status' => 'required|integer'

        ]);

        return $service->getTickets($request);   

    }

    public function show($id)
    {

        // show ticket by id

        $supportTicket = ShowTicketToAdminQuery::getData($id);   

        return ['ticket' => $supportTicket];

    }

    public function getSupportDataFilters()
    {

        // get form configs for filter

        return SupportTicketByStatusService::getFormConfigs();

    }

    public function getSupportReplyFormConfig()
    {

        // get form configs for reply form

        return SupportReplyService::getFormConfigs();

    }

    public function supportReplyToTicket(Request $request)
    {

        // reply to ticket

        return SupportReplyToTicketService::replyToTicket($request);

    }

    public function closeTicket(Request $request)
    {

        $request->validate([

            'id' => 'required|integer'

        ]);

        // close ticket

        return CloseTicketService::closeTicket($request);

    }

}
