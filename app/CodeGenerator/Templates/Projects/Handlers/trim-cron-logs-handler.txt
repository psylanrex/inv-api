<?php

namespace App\Services\Crons\Handlers;

use Carbon\Carbon;
use App\Models\CronLog;
use DB;

class TrimCronLogsHandler
{

    public function handleTrimCronLogs()
    {

        // Get the date one week ago

        $one_week_ago = Carbon::now()->subWeek();

        // Delete records older than one week

        try{

            if ( CronLog::where('created_at', '<', $one_week_ago)->exists() ) {

                CronLog::where('created_at', '<', $one_week_ago)->delete();
    
            } 

            return ['success' => 1, 'cron_fail_details' => NULL];

        } catch (\Exception $e) {

            // Log the exception message to the CronFailLog table

            // the specific details
    
            $cron_fail_details = $this->errorMessage() . $e->getMessage();   
            
            return ['success' => 0, 'cron_fail_details' => $cron_fail_details];

        }

    }

    public function errorMessage()
    {

        return 'Trim logs failed to trim anything. ';

    }

}